{% extends 'main/base.html' %}
{% load static %}

{% block content %}

<style>
  html, body {
      height: 100%;
      margin: 0;
      font-family: 'Poppins', sans-serif;
  }

  .content {
      margin-top: 80px; /* navbar height */
      margin-left: 250px; /* sidebar width if active */
      padding: 20px;
      height: calc(100vh - 80px);
      display: flex;
      overflow: hidden;
  }

  .tracking-page {
      display: flex;
      width: 100%;
      gap: 30px;
      height: 100%;
      padding: 10px;
      box-sizing: border-box;
  }

  /* Info Card (Left) */
  .info-card {
      width: fit-content;         /* width adjusts to content */
      max-width: 350px;           /* don't grow too much */
      background: #ffffff;
      padding: 30px 25px;
      border-radius: 20px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      border: 2px solid #00acc1;
      display: flex;
      flex-direction: column;
      justify-content: center;     /* vertical center */
      align-self: center;          /* vertically center within flex container */
      margin-left: 10px;
  }

  .info-card h2 {
      font-size: 22px;
      color: #023047;
      margin-bottom: 15px;
      font-weight: 700;
  }

  .info-card p {
      margin: 12px 0;
      font-size: 18px;
      font-weight: 600;
      color: #023047;
  }

  .info-card p span {
      color: #0077b6;
      font-weight: 700;
  }

  /* Map (Right) */
  #ambulanceMap {
      flex: 1;
      height: 100%;
      border: 3px solid #00acc1;
      border-radius: 16px;
      margin-right: 10px;
  }

  /* Responsive */
  @media(max-width:1024px){
      .tracking-page { flex-direction: column; }
      #ambulanceMap { height: 60vh; margin-right: 0; }
      .info-card { width: 100%; margin-left: 0; margin-bottom: 20px; align-self: flex-start; }
  }
</style>

<div class="tracking-page">

    <!-- Info Card -->
    <div class="info-card">
        <h2>Tracking Ambulance Live Movements</h2>
        <p><strong>Source:</strong> <span>Navy Hospital</span></p>
        <p><strong>Destination:</strong> <span>Trauma Center</span></p>
        <p><strong>Distance Left:</strong> <span>12 km</span></p>
        <p><strong>Estimated Arrival:</strong> <span>25 mins</span></p>
    </div>

    <!-- Map -->
    <div id="ambulanceMap"></div>

</div>

<!-- Leaflet JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    const map = L.map('ambulanceMap').setView([28.6139, 77.2090], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const ambulanceIcon = L.icon({
        iconUrl: '{% static "images/ambulance.png" %}',
        iconSize: [40, 40],
        iconAnchor: [20, 20]
    });

    const ambulanceMarker = L.marker([28.6139, 77.2090], {icon: ambulanceIcon}).addTo(map)
        .bindPopup("Ambulance Current Location").openPopup();

    const destinationMarker = L.marker([28.6200, 77.2100]).addTo(map)
        .bindPopup("Destination: Trauma Center").openPopup();

    const route = L.polyline([
        [28.6139, 77.2090],
        [28.6200, 77.2100]
    ], {color: '#0077b6', weight: 5}).addTo(map);
</script>

{% endblock %}
